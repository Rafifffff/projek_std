<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Penilaian Kredit | FIFGROUP</title>

  <!-- Font Google -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #f2f4f8;
      color: #333;
    }

    header {
      background-color: #ffffff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      padding: 15px 60px;
      display: flex;
      align-items: center;
    }

    header img {
      width: 180px;
      height: auto;
    }

    /* Layout 2 panel */
    .main-section {
      display: flex;
      min-height: calc(100vh - 100px);
    }

    /* Panel kiri */
    .left-panel {
      width: 35%;
      background-color: #1f4d8f;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      padding: 60px;
    }

    .left-panel h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .left-panel p {
      font-size: 14px;
      line-height: 1.6;
      max-width: 80%;
      opacity: 0.9;
    }

    /* Panel kanan (form) */
    .right-panel {
      width: 65%;
      background-color: #f9fafc;
      padding: 60px 80px;
      overflow-y: auto;
    }

    .right-panel h2 {
      font-size: 20px;
      font-weight: 600;
      color: #1f4d8f;
      margin-bottom: 30px;
    }

    /* Form styling */
    form label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #555;
    }

    form input, form select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 22px;
      font-size: 15px;
      color: #444;
      background-color: #fff;
      transition: 0.3s;
      box-sizing: border-box;
    }

    form input:focus, form select:focus {
      outline: none;
      border-color: #1f4d8f;
      box-shadow: 0 0 5px rgba(31, 77, 143, 0.2);
    }

    .btn {
      background-color: #1f4d8f;
      color: white;
      border: none;
      padding: 14px;
      border-radius: 8px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn:hover {
      background-color: #163b72;
    }

    .btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    /* API Key Section */
    .api-key-section {
      background-color: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 30px;
    }

    .api-key-section label {
      color: #856404;
      font-weight: 600;
    }

    .api-key-section input {
      margin-bottom: 0;
    }

    .api-key-section small {
      color: #856404;
      display: block;
      margin-top: 8px;
      font-size: 13px;
    }

    /* Result Section */
    .result-section {
      margin-top: 30px;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    .result-section.approved {
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .result-section.rejected {
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .result-section.review {
      background-color: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }

    .result-section h3 {
      margin-top: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .result-section p {
      line-height: 1.6;
      margin: 10px 0;
    }

    .loading {
      text-align: center;
      padding: 20px;
      display: none;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #1f4d8f;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 900px) {
      .main-section {
        flex-direction: column;
      }
      .left-panel, .right-panel {
        width: 100%;
        padding: 40px;
      }
    }
  </style>
</head>
<body>

  <header>
    <img src="fifgroup-logo.webp" alt="FIFGROUP Logo">
  </header>

  <!-- Load configuration -->
  <script src="config.js"></script>

  <section class="main-section">
    <!-- Panel kiri -->
    <div class="left-panel">
      <h1>Form Penilaian Kredit Berbasis AI</h1>
      <p>Isi data berikut untuk membantu sistem AI kami menilai kelayakan kredit Anda dengan cepat dan akurat menggunakan teknologi Groq AI.</p>
    </div>

    <!-- Panel kanan -->
    <div class="right-panel">
      <h2>Data Pengajuan Kredit</h2>

      <form id="creditForm">
        <label>Nama Lengkap</label>
        <input type="text" id="nama" placeholder="Masukkan nama lengkap" required>

        <label>NIK (Nomor KTP)</label>
        <input type="text" id="nik" placeholder="Masukkan NIK Anda" required>

        <label>Usia</label>
        <input type="number" id="usia" min="18" max="70" placeholder="Masukkan usia" required>

        <label>Pekerjaan</label>
        <select id="pekerjaan" required>
          <option value="">Pilih salah satu</option>
          <option>Karyawan Swasta</option>
          <option>PNS</option>
          <option>Wiraswasta</option>
          <option>Freelancer</option>
        </select>

        <label>Pendapatan Bulanan (Rp)</label>
        <input type="number" id="pendapatan" placeholder="Masukkan pendapatan bulanan" required>

        <label>Jumlah Pinjaman yang Diajukan (Rp)</label>
        <input type="number" id="pinjaman" placeholder="Masukkan nominal pinjaman" required>

        <label>Tujuan Pinjaman</label>
        <select id="tujuan" required>
          <option value="">Pilih tujuan pinjaman</option>
          <option>Pembelian Motor</option>
          <option>Modal Usaha</option>
          <option>Pendidikan</option>
          <option>Kebutuhan Rumah Tangga</option>
        </select>

        <label>Durasi Tenor (bulan)</label>
        <select id="tenor" required>
          <option value="">Pilih tenor</option>
          <option>6</option>
          <option>12</option>
          <option>24</option>
          <option>36</option>
        </select>

        <button type="submit" class="btn" id="submitBtn">Analisis Kelayakan Kredit dengan AI</button>
      </form>

      <!-- Loading Indicator -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Menganalisis data Anda dengan AI...</p>
      </div>

      <!-- Result Section -->
      <div class="result-section" id="resultSection">
        <h3 id="resultTitle"></h3>
        <div id="resultContent"></div>
      </div>
    </div>
  </section>

  <script>
    const form = document.getElementById('creditForm');
    const loading = document.getElementById('loading');
    const resultSection = document.getElementById('resultSection');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Get API Key from config
      const apiKey = CONFIG.GROQ_API_KEY;
      if (!apiKey || apiKey === 'your-groq-api-key-here') {
        alert('API Key belum dikonfigurasi! Silakan hubungi administrator.');
        return;
      }

      // Get form data
      const formData = {
        nama: document.getElementById('nama').value,
        nik: document.getElementById('nik').value,
        usia: document.getElementById('usia').value,
        pekerjaan: document.getElementById('pekerjaan').value,
        pendapatan: document.getElementById('pendapatan').value,
        pinjaman: document.getElementById('pinjaman').value,
        tujuan: document.getElementById('tujuan').value,
        tenor: document.getElementById('tenor').value
      };

      // Calculate debt-to-income ratio
      const cicilan = calculateMonthlyPayment(formData.pinjaman, formData.tenor);
      const dti = (cicilan / formData.pendapatan * 100).toFixed(2);

      // Show loading
      loading.classList.add('active');
      resultSection.style.display = 'none';
      submitBtn.disabled = true;

      try {
        // Create prompt for Groq API
        const prompt = `Anda adalah seorang analis kredit profesional di FIFGROUP. Analisis data pengajuan kredit berikut dan berikan keputusan kelayakan kredit.

DATA PEMOHON:
- Nama: ${formData.nama}
- NIK: ${formData.nik}
- Usia: ${formData.usia} tahun
- Pekerjaan: ${formData.pekerjaan}
- Pendapatan Bulanan: Rp ${formatRupiah(formData.pendapatan)}
- Jumlah Pinjaman: Rp ${formatRupiah(formData.pinjaman)}
- Tujuan Pinjaman: ${formData.tujuan}
- Tenor: ${formData.tenor} bulan
- Estimasi Cicilan Bulanan: Rp ${formatRupiah(cicilan)}
- Debt-to-Income Ratio: ${dti}%

INSTRUKSI ANALISIS:
1. Evaluasi kelayakan kredit berdasarkan:
   - Rasio cicilan terhadap pendapatan (idealnya < 30%)
   - Stabilitas pekerjaan
   - Kelayakan usia untuk tenor yang dipilih
   - Kesesuaian jumlah pinjaman dengan pendapatan

2. Berikan keputusan: DISETUJUI, DITOLAK, atau PERLU PENINJAUAN

3. Format response HARUS dalam format JSON seperti ini:
{
  "keputusan": "DISETUJUI/DITOLAK/PERLU PENINJAUAN",
  "skor_kelayakan": 75,
  "alasan": "Penjelasan singkat keputusan",
  "rekomendasi": "Saran atau rekomendasi untuk pemohon",
  "detail_analisis": {
    "rasio_cicilan": "Baik/Cukup/Kurang",
    "stabilitas_pekerjaan": "Baik/Cukup/Kurang",
    "kemampuan_bayar": "Baik/Cukup/Kurang"
  }
}

Berikan HANYA response dalam format JSON, tanpa penjelasan tambahan.`;

        // Call Groq API
        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'llama-3.3-70b-versatile',
            messages: [
              {
                role: 'system',
                content: 'Anda adalah AI analis kredit profesional yang memberikan analisis objektif dan terstruktur dalam format JSON.'
              },
              {
                role: 'user',
                content: prompt
              }
            ],
            temperature: 0.7,
            max_tokens: 1000
          })
        });

        if (!response.ok) {
          throw new Error(`API Error: ${response.status} - ${response.statusText}`);
        }

        const data = await response.json();
        const aiResponse = data.choices[0].message.content;
        
        // Parse AI response
        let result;
        try {
          // Extract JSON from response (in case there's extra text)
          const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
          result = JSON.parse(jsonMatch ? jsonMatch[0] : aiResponse);
        } catch (parseError) {
          console.error('Parse error:', parseError);
          throw new Error('Format response AI tidak valid');
        }

        // Display result
        displayResult(result, formData, cicilan, dti);

      } catch (error) {
        console.error('Error:', error);
        resultSection.className = 'result-section rejected';
        resultSection.style.display = 'block';
        document.getElementById('resultTitle').textContent = '❌ Terjadi Kesalahan';
        document.getElementById('resultContent').innerHTML = `
          <p><strong>Error:</strong> ${error.message}</p>
          <p>Mohon periksa API key Anda dan coba lagi.</p>
        `;
      } finally {
        loading.classList.remove('active');
        submitBtn.disabled = false;
      }
    });

    function displayResult(result, formData, cicilan, dti) {
      resultSection.style.display = 'block';
      
      // Determine result class
      let resultClass = 'review';
      if (result.keputusan === 'DISETUJUI') {
        resultClass = 'approved';
      } else if (result.keputusan === 'DITOLAK') {
        resultClass = 'rejected';
      }
      
      resultSection.className = `result-section ${resultClass}`;
      
      // Set title
      const icon = result.keputusan === 'DISETUJUI' ? '✅' : 
                   result.keputusan === 'DITOLAK' ? '❌' : '⚠️';
      document.getElementById('resultTitle').textContent = `${icon} ${result.keputusan}`;
      
      // Set content
      document.getElementById('resultContent').innerHTML = `
        <p><strong>Skor Kelayakan:</strong> ${result.skor_kelayakan}/100</p>
        <p><strong>Alasan:</strong> ${result.alasan}</p>
        
        <p><strong>Detail Analisis:</strong></p>
        <ul>
          <li>Rasio Cicilan/Pendapatan: ${dti}% - ${result.detail_analisis.rasio_cicilan}</li>
          <li>Stabilitas Pekerjaan: ${result.detail_analisis.stabilitas_pekerjaan}</li>
          <li>Kemampuan Bayar: ${result.detail_analisis.kemampuan_bayar}</li>
        </ul>
        
        <p><strong>Estimasi Cicilan Bulanan:</strong> Rp ${formatRupiah(cicilan)}</p>
        <p><strong>Rekomendasi:</strong> ${result.rekomendasi}</p>
      `;
    }

    function calculateMonthlyPayment(principal, months) {
      // Simple interest rate 12% per year
      const rate = 0.12 / 12;
      const payment = (principal * rate * Math.pow(1 + rate, months)) / 
                     (Math.pow(1 + rate, months) - 1);
      return Math.round(payment);
    }

    function formatRupiah(angka) {
      return new Intl.NumberFormat('id-ID').format(angka);
    }
  </script>

</body>
</html>
